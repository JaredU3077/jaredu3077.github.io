<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Engineer OS Theme</title>
    <link rel="stylesheet" href="theme.css">
    <!-- Include Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Include vis.js for network topology map -->
    <script src="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.js"></script>
    <!-- Include interact.js for draggable and resizable windows -->
    <script src="https://unpkg.com/interactjs@1.10.27/dist/interact.min.js"></script>
</head>
<body>
    <!-- Desktop container for icons -->
    <div class="desktop" id="desktop">
        <!-- Desktop icons will be dynamically generated -->
    </div>

    <!-- Taskbar with Start menu -->
    <div class="taskbar">
        <button class="start-btn" id="startBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 12h18M3 6h18M3 18h18"/>
            </svg>
            <span>Start</span>
        </button>
        <div class="start-menu" id="startMenu">
            <!-- Start menu items will be dynamically generated -->
        </div>
        <div class="taskbar-tools" id="taskbarTools">
            <!-- Taskbar icons will be dynamically generated -->
        </div>
        <div class="branding">@JaredU_</div>
    </div>

    <!-- Scripts -->
    <script type="module">
        import { ContentParser } from './js/parser.js';
        import { Terminal } from './js/terminal.js';
        import { WindowManager } from './js/window.js';
        import { NetworkVisualization } from './js/network.js';
        import { KeyboardManager } from './js/keyboard.js';
        import { HelpManager } from './js/help.js';
        import { SearchManager } from './js/search.js';
        import { UI_CONFIG, createAppButton } from './js/config.js';

        // Initialize modules
        const windowManager = new WindowManager();
        const helpManager = new HelpManager();
        const searchManager = new SearchManager();
        let network = null;
        let terminal = null;

        // Initialize UI elements
        function initializeUI() {
            const desktop = document.getElementById('desktop');
            const startMenu = document.getElementById('startMenu');
            const taskbarTools = document.getElementById('taskbarTools');

            // Create desktop icons
            Object.values(UI_CONFIG.applications).forEach(app => {
                desktop.insertAdjacentHTML('beforeend', createAppButton(app, 'desktop'));
            });

            // Create start menu items
            Object.values(UI_CONFIG.applications).forEach(app => {
                startMenu.insertAdjacentHTML('beforeend', createAppButton(app, 'start-menu'));
            });

            // Create taskbar icons
            Object.values(UI_CONFIG.applications).forEach(app => {
                taskbarTools.insertAdjacentHTML('beforeend', createAppButton(app, 'taskbar'));
            });

            // Add help button to taskbar
            taskbarTools.insertAdjacentHTML('beforeend', `
                <button class="taskbar-icon" title="Help">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M12 16v-4M12 8h.01"/>
                    </svg>
                </button>
            `);
        }

        // Initialize start menu
        const startBtn = document.getElementById('startBtn');
        const startMenu = document.getElementById('startMenu');
        
        startBtn.addEventListener('click', () => {
            startMenu.style.display = startMenu.style.display === 'flex' ? 'none' : 'flex';
        });

        // Close start menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.start-btn') && !e.target.closest('.start-menu')) {
                startMenu.style.display = 'none';
            }
        });

        // Initialize icon and taskbar button clicks
        function handleAppClick(appId) {
            const app = UI_CONFIG.applications[appId];
            if (!app) return;

            app.windows.forEach(windowConfig => {
                const win = windowManager.createWindow({
                    id: windowConfig.id,
                    title: windowConfig.title,
                    content: windowConfig.content,
                    width: windowConfig.width,
                    height: windowConfig.height
                });

                // Initialize specific app functionality
                switch (appId) {
                    case 'terminal':
                        terminal = new Terminal(
                            win.querySelector('#terminalInput'),
                            win.querySelector('#terminalOutput')
                        );
                        break;
                    case 'network-monitor':
                        if (windowConfig.id === 'topologyWindow') {
                            network = new NetworkVisualization('networkTopology');
                        }
                        break;
                    case 'codex':
                        if (windowConfig.id === 'codexWindow') {
                            searchManager.initializeSearch();
                        }
                        break;
                }
            });
        }

        // Add click handlers
        document.addEventListener('click', (e) => {
            const button = e.target.closest('[data-tool]');
            if (button) {
                handleAppClick(button.dataset.tool);
            }
        });

        // Initialize UI
        initializeUI();
    </script>
</body>
</html>
