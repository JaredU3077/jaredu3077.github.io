<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Engineer OS Theme</title>
    <link rel="stylesheet" href="theme.css">
    <!-- Include Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Include vis.js for network topology map -->
    <script src="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.js"></script>
    <!-- Include interact.js for draggable and resizable windows -->
    <script src="https://unpkg.com/interactjs@1.10.27/dist/interact.min.js"></script>
</head>
<body>
    <!-- Desktop container for icons -->
    <div class="desktop">
        <!-- Desktop icons for network tools -->
        <div class="icon" data-tool="network-monitor">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--primary-color)" stroke-width="2">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                <path d="M12 6v6l4 2"/>
            </svg>
            <span>Network Monitor</span>
        </div>
        <div class="icon" data-tool="device-manager">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--primary-color)" stroke-width="2">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                <path d="M12 8v8M8 12h8"/>
            </svg>
            <span>Device Manager</span>
        </div>
        <div class="icon" data-tool="terminal">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--primary-color)" stroke-width="2">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                <path d="M8 12l4 4 4-4M12 8v8"/>
            </svg>
            <span>Terminal</span>
        </div>
        <div class="icon" data-tool="codex">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="var(--primary-color)" stroke-width="2">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                <path d="M8 7h8M8 12h8M8 17h4"/>
            </svg>
            <span>Codex</span>
        </div>
    </div>

    <!-- Remove all static window HTML here. Only keep desktop, taskbar, and help content. -->

    <!-- Taskbar with Start menu -->
    <div class="taskbar">
        <button class="start-btn" id="startBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 12h18M3 6h18M3 18h18"/>
            </svg>
            <span>Start</span>
        </button>
        <div class="start-menu" id="startMenu">
            <button data-tool="network-monitor">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                    <path d="M12 6v6l4 2"/>
                </svg>
                <span>Network Monitor</span>
            </button>
            <button data-tool="device-manager">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                    <path d="M12 8v8M8 12h8"/>
                </svg>
                <span>Device Manager</span>
            </button>
            <button data-tool="terminal">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                    <path d="M8 12l4 4 4-4M12 8v8"/>
                </svg>
                <span>Terminal</span>
            </button>
            <button data-tool="codex">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                    <path d="M8 7h8M8 12h8M8 17h4"/>
                </svg>
                <span>Codex</span>
            </button>
        </div>
        <div class="taskbar-tools">
            <button data-tool="network-monitor" class="taskbar-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                    <path d="M12 6v6l4 2"/>
                </svg>
            </button>
            <button data-tool="device-manager" class="taskbar-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                    <path d="M12 8v8M8 12h8"/>
                </svg>
            </button>
            <button data-tool="terminal" class="taskbar-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                    <path d="M8 12l4 4 4-4M12 8v8"/>
                </svg>
            </button>
            <button data-tool="codex" class="taskbar-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                    <path d="M8 7h8M8 12h8M8 17h4"/>
                </svg>
            </button>
            <button class="taskbar-icon" title="Help">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 16v-4M12 8h.01"/>
                </svg>
            </button>
        </div>
        <div class="branding">@JaredU_</div>
    </div>

    <!-- Scripts -->
    <script type="module">
        import { ContentParser } from './js/parser.js';
        import { Terminal } from './js/terminal.js';
        import { WindowManager } from './js/window.js';
        import { NetworkVisualization } from './js/network.js';
        import { KeyboardManager } from './js/keyboard.js';
        import { HelpManager } from './js/help.js';
        import { SearchManager } from './js/search.js';
        import { CONFIG } from './js/config.js';

        // Initialize modules
        const windowManager = new WindowManager();
        const helpManager = new HelpManager();
        const searchManager = new SearchManager();
        let network = null;
        let terminal = null;

        // Initialize start menu
        const startBtn = document.getElementById('startBtn');
        const startMenu = document.getElementById('startMenu');
        
        startBtn.addEventListener('click', () => {
            startMenu.style.display = startMenu.style.display === 'flex' ? 'none' : 'flex';
        });

        // Close start menu when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.start-btn') && !e.target.closest('.start-menu')) {
                startMenu.style.display = 'none';
            }
        });

        // Initialize icon and taskbar button clicks
        document.querySelectorAll('.icon, .taskbar-icon, .start-menu button').forEach(el => {
            el.addEventListener('click', () => {
                const tool = el.dataset.tool;
                switch (tool) {
                    case 'terminal': {
                        const win = windowManager.createWindow({
                            id: 'terminalWindow',
                            title: 'Terminal',
                            content: `
                                <div id="terminalOutput"></div>
                                <input type="text" id="terminalInput" placeholder="Type command...">
                            `,
                            width: 600,
                            height: 400,
                            icon: 'fa-terminal'
                        });
                        // Dynamically initialize Terminal for this window
                        terminal = new Terminal(
                            win.querySelector('#terminalInput'),
                            win.querySelector('#terminalOutput')
                        );
                        break;
                    }
                    case 'network-monitor': {
                        const topologyWin = windowManager.createWindow({
                            id: 'topologyWindow',
                            title: 'Network Topology',
                            content: `
                                <div class="topology-map" id="networkTopology"></div>
                            `,
                            width: 800,
                            height: 600,
                            icon: 'fa-network-wired'
                        });
                        
                        // Initialize network visualization after window is created
                        network = new NetworkVisualization('networkTopology');
                        
                        const widgetsWin = windowManager.createWindow({
                            id: 'widgetsWindow',
                            title: 'Network Status',
                            content: `
                                <div class="widgets">
                                    <div class="widget">
                                        <h3>Bandwidth Usage</h3>
                                        <p id="bandwidth">0 Mbps</p>
                                    </div>
                                    <div class="widget">
                                        <h3>Network Alerts</h3>
                                        <p id="alerts">No alerts</p>
                                    </div>
                                </div>
                            `,
                            width: 300,
                            height: 200,
                            icon: 'fa-chart-line'
                        });
                        break;
                    }
                    case 'codex': {
                        const win = windowManager.createWindow({
                            id: 'codexWindow',
                            title: 'Codex of Financial Instruments',
                            content: `
                                <div id="codexContent"></div>
                            `,
                            width: 800,
                            height: 600,
                            icon: 'fa-book'
                        });
                        // Initialize search for the Codex window
                        searchManager.initializeSearch();
                        break;
                    }
                    case 'device-manager': {
                        windowManager.createWindow({
                            id: 'deviceManagerWindow',
                            title: 'Device Manager',
                            content: `<div class="device-list">No devices found. (Demo)</div>`,
                            width: 500,
                            height: 300,
                            icon: 'fa-server'
                        });
                        break;
                    }
                }
            });
        });

        // Add Help button to taskbar
        const helpBtn = document.createElement('button');
        helpBtn.className = 'taskbar-icon';
        helpBtn.title = 'Help';
        helpBtn.innerHTML = `<i class="fas fa-question-circle"></i>`;
        document.querySelector('.taskbar-tools').appendChild(helpBtn);
        helpBtn.addEventListener('click', () => {
            let helpWin = document.getElementById('helpWindow');
            if (!helpWin) {
                helpWin = windowManager.createWindow({
                    id: 'helpWindow',
                    title: 'Help',
                    content: `<div id="helpContent"></div>`,
                    width: 600,
                    height: 500,
                    icon: 'fa-question-circle'
                });
            }
            helpManager.showHelp('terminal');
        });

        // After all modules are initialized, connect KeyboardManager
        const keyboardManager = new KeyboardManager(windowManager, terminal, network);

        // Only start network updates when the network window is opened
        // Only show help when help window is opened
    </script>
</body>
</html>
