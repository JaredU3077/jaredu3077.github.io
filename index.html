<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Engineer OS Theme</title>
    <link rel="stylesheet" href="theme.css">
    <!-- Include vis.js for network topology map -->
    <script src="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.js"></script>
    <!-- Include interact.js for draggable and resizable windows -->
    <script src="https://unpkg.com/interactjs@1.10.27/dist/interact.min.js"></script>
</head>
<body>
    <!-- Desktop container for icons -->
    <div class="desktop">
        <!-- Desktop icons for network tools -->
        <div class="icon" data-tool="network-monitor">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#4682B4" stroke-width="2">
                <path d="M1 12h22M12 1v22M3 3l18 18M3 21L21 3"/>
            </svg>
            <span>Network Monitor</span>
        </div>
        <div class="icon" data-tool="device-manager">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#4682B4" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2"/>
                <circle cx="12" cy="12" r="3"/>
            </svg>
            <span>Device Manager</span>
        </div>
        <div class="icon" data-tool="terminal">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#4682B4" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2"/>
                <path d="M7 15l4-4-4-4M12 15h5"/>
            </svg>
            <span>Terminal</span>
        </div>
        <div class="icon" data-tool="codex">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#4682B4" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2"/>
                <path d="M7 7h10M7 12h10M7 17h10"/>
            </svg>
            <span>Codex</span>
        </div>
    </div>

    <!-- Topology map window -->
    <div class="window" id="topologyWindow">
        <div class="window-header">
            <span>Network Topology</span>
            <div class="window-controls">
                <button class="minimize-btn">-</button>
                <button class="maximize-btn">□</button>
                <button class="close-btn">×</button>
            </div>
        </div>
        <div class="window-body">
            <div class="topology-map" id="networkTopology"></div>
        </div>
    </div>

    <!-- Widgets window -->
    <div class="window" id="widgetsWindow">
        <div class="window-header">
            <span>Network Status</span>
            <div class="window-controls">
                <button class="minimize-btn">-</button>
                <button class="maximize-btn">□</button>
                <button class="close-btn">×</button>
            </div>
        </div>
        <div class="window-body">
            <div class="widgets">
                <div class="widget">
                    <h3>Bandwidth Usage</h3>
                    <p id="bandwidth">0 Mbps</p>
                </div>
                <div class="widget">
                    <h3>Network Alerts</h3>
                    <p id="alerts">No alerts</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Terminal window -->
    <div class="window" id="terminalWindow">
        <div class="window-header">
            <span>Terminal</span>
            <div class="window-controls">
                <button class="minimize-btn">-</button>
                <button class="maximize-btn">□</button>
                <button class="close-btn">×</button>
            </div>
        </div>
        <div class="window-body">
            <div id="terminalOutput"></div>
            <input type="text" id="terminalInput" placeholder="Type command...">
        </div>
    </div>

    <!-- Codex window -->
    <div class="window" id="codexWindow">
        <div class="window-header">
            <span>Codex of Financial Instruments</span>
            <div class="window-controls">
                <button class="minimize-btn">-</button>
                <button class="maximize-btn">□</button>
                <button class="close-btn">×</button>
            </div>
        </div>
        <div class="window-body" id="codexContent">
            <!-- Content will be loaded dynamically -->
        </div>
    </div>

    <!-- Help Window -->
    <div id="helpWindow" class="window">
        <div class="window-header">
            <span>Help</span>
            <div class="window-controls">
                <button class="minimize-btn">-</button>
                <button class="maximize-btn">□</button>
                <button class="close-btn">×</button>
            </div>
        </div>
        <div class="window-body">
            <div class="help-tabs">
                <button class="help-tab active" data-section="terminal">Terminal</button>
                <button class="help-tab" data-section="shortcuts">Shortcuts</button>
                <button class="help-tab" data-section="windows">Windows</button>
            </div>
            <div id="helpContent"></div>
        </div>
    </div>

    <!-- Taskbar with Start menu -->
    <div class="taskbar">
        <button class="start-btn">Start</button>
        <div class="start-menu" id="startMenu">
            <button data-tool="network-monitor">Network Monitor</button>
            <button data-tool="device-manager">Device Manager</button>
            <button data-tool="terminal">Terminal</button>
            <button data-tool="codex">Codex</button>
        </div>
        <div class="taskbar-tools">
            <button data-tool="network-monitor" class="taskbar-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#E0E0E0" stroke-width="2">
                    <path d="M1 12h22M12 1v22M3 3l18 18M3 21L21 3"/>
                </svg>
            </button>
            <button data-tool="device-manager" class="taskbar-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#E0E0E0" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                    <circle cx="12" cy="12" r="3"/>
                </svg>
            </button>
            <button data-tool="terminal" class="taskbar-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#E0E0E0" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                    <path d="M7 15l4-4-4-4M12 15h5"/>
                </svg>
            </button>
            <button data-tool="codex" class="taskbar-icon">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#E0E0E0" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                    <path d="M7 7h10M7 12h10M7 17h10"/>
                </svg>
            </button>
        </div>
        <div class="branding">@JaredU_</div>
    </div>

    <!-- Scripts -->
    <script type="module">
        import { ContentParser } from './js/parser.js';
        import { Terminal } from './js/terminal.js';
        import { WindowManager } from './js/window.js';
        import { NetworkVisualization } from './js/network.js';
        import { KeyboardManager } from './js/keyboard.js';
        import { HelpManager } from './js/help.js';
        import { SearchManager } from './js/search.js';
        import { CONFIG } from './js/config.js';

        // Initialize modules
        const windowManager = new WindowManager();
        const terminal = new Terminal(
            document.getElementById('terminalInput'),
            document.getElementById('terminalOutput')
        );
        const network = new NetworkVisualization('networkTopology');
        const keyboardManager = new KeyboardManager(windowManager, terminal, network);
        const helpManager = new HelpManager();
        const searchManager = new SearchManager();

        // Load Codex content
        ContentParser.loadAndParseContent(CONFIG.PATHS.CODEX)
            .then(content => {
                document.getElementById('codexContent').innerHTML = content;
                // Index content for search
                searchManager.indexContent(content);
            })
            .catch(error => {
                console.error('Error loading Codex content:', error);
                document.getElementById('codexContent').innerHTML = '<p>Error loading Codex content.</p>';
            });

        // Start network updates
        network.startUpdates();

        // Initialize icon and taskbar button clicks
        document.querySelectorAll('.icon, .taskbar-icon, .start-menu button').forEach(el => {
            el.addEventListener('click', () => {
                const tool = el.dataset.tool;
                if (tool === 'terminal') {
                    windowManager.showWindow('terminalWindow');
                } else if (tool === 'network-monitor') {
                    windowManager.showWindow('topologyWindow');
                    windowManager.showWindow('widgetsWindow');
                } else if (tool === 'codex') {
                    windowManager.showWindow('codexWindow');
                }
            });
        });

        // Initialize help system
        document.querySelectorAll('.help-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Update active tab
                document.querySelectorAll('.help-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show help content
                helpManager.showHelp(tab.dataset.section);
            });
        });

        // Show initial help content
        helpManager.showHelp('terminal');
    </script>
</body>
</html>
